#!/usr/bin/expect -f

# host simulator test
if { $argc == 2 } {
  set command [lindex $argv 0]
  set log [lindex $argv 1]
  log_file $log
  proc send_string { string } { send $string }
  spawn sh -c "STARTTIME=1672531200 LATITUDE=-34.9251188 LONGITUDE=138.600888 $command"
}

# real hardware test
if { $argc == 1 } {
  set port [lindex $argv 0]
  proc send_string { string } {
    puts "\r\n$string"
    send $string
  }
  spawn sh -c "stty -F $port 9600 raw -echo"
  spawn -open [open $port w+]
}

proc abort { } { send_user "Timeout!\r\n" }
expect_before timeout abort

# wait a bit longer for the first returns
set timeout 20
expect "+STATE=INITIALIZING"
expect "+STATE=READY"
set timeout 6

## QUERIES
# comm check
send_string "AT\r"
expect "OK"
# message queue
send_string "AT+MSGQ=?\r"
expect -re {OK\+MSGQ=[0-9]{1,3}\s+}
# message queue status
send_string "AT+MSGQS=?\r"
expect -re {OK\+MSGQS=EMPTY\s+}

# multiple commands
send_string "AT+MSGQ=?\r\nAT\r\n"
expect -re {OK\+MSGQ=[0-9]{1,3}\s+}
expect "OK"
# state
send_string "AT+STATE=?\t\r"
expect "OK+STATE=READY"
# sdk version
send_string "AT+VSDK=? \r"
expect -re {OK\+VSDK=[0-9]\.[0-9]\.[0-9]\s+}
# module id
send_string "AT+MID=?\r"
expect -re {OK\+MID=00[0-9a-f]{8} M[1-2]-2[3-4]\s+}
# regcode
send_string "AT+REGCODE=?\r"
expect -re {OK\+REGCODE=[0-9a-z]{25}\s+}
# time
send_string "AT+TIME=?\r"
expect -re {OK\+TIME=}
# location
send_string "AT+LOCATION=?\r"
expect -re {OK\+LOCATION=}
# no query command match - 1
send_string "AT+REGCOD=?\r"
expect "ERROR=UNKNOWN_QUERY_CMD"
# no query command match - 2
send_string "AT+SAVEMSG=?\r"
expect "ERROR=UNKNOWN_QUERY_CMD"
# no query command match - 3
send_string "AT+COmM=?\r"
expect "ERROR=UNKNOWN_QUERY_CMD"

## CONTROLS
# save message
send_string "AT+SAVEMSG\r"
expect "OK+SAVEMSG"
# save message with parameter
send_string "AT+SAVEMSG=1\r"
expect "FAIL+SAVEMSG"
# tx start
send_string "AT+TXSTART\r"
expect "FAIL+TXSTART"
# tx start with parameter - 1
send_string "AT+TXSTART=161000000,0,0,60\r"
expect "OK+TXSTART=161000000,0,0,60"
# tx start with parameter - 2
send_string "AT+TXSTART=161000000,1,1,60\r"
expect "OK+TXSTART=161000000,1,1,60"
# tx start with parameter - 3
send_string "AT+TXSTART=180000000,1,1,60\r"
expect "FAIL+TXSTART=180000000,1,1,60"
# tx start with parameter - 4
send_string "AT+TXSTART=140000000,1,1,60\r"
expect "FAIL+TXSTART=140000000,1,1,60"
# tx start with parameter - 5
send_string "AT+TXSTART=i61000000,1,1,60\r"
expect "FAIL+TXSTART=i61000000,1,1,60"
# tx start with parameter - 6
send_string "AT+TXSTART=161000000,0,0,1000\r"
expect "FAIL+TXSTART=161000000,0,0,1000"
# tx start with parameter - 7
send_string "AT+TXSTART=161000000\r"
expect "FAIL+TXSTART=161000000"
# tx start with parameter - 8
send_string "AT+TXSTART=161000000,1\r"
expect "FAIL+TXSTART=161000000,1"
# tx start with parameter - 9
send_string "AT+TXSTART=161000000,1,1\r"
expect "FAIL+TXSTART=161000000,1,1"
# tx stop
send_string "AT+TXSTOP\r"
expect "OK+TXSTOP"
# tx stop with parameter
send_string "AT+TXSTOP=1\r"
expect "FAIL+TXSTOP"
# gnss fix
send_string "AT+GNSSFIX\r"
expect "OK+GNSSFIX"
expect "OK+GNSSFIX"
# gnss fix with parameter
send_string "AT+GNSSFIX=1\r"
expect "FAIL+GNSSFIX"
# rssi start
send_string "AT+RSSI\r"
expect "FAIL+RSSI"
# rssi start with frequency - 1
send_string "AT+RSSI=360000000\r"
expect -re {OK\+RSSI=\-[0-9]{2,3}\s+}
# rssi start with frequency - 2
send_string "AT+RSSI=340000000\r"
expect "FAIL+RSSI=340000000"
# rssi start with frequency - 3
send_string "AT+RSSI=430000000\r"
expect "FAIL+RSSI=430000000"
# set time to 0 and verify
send_string "AT+TIME=0\r"
expect -re {OK\+TIME=[0-9]}
send_string "AT+TIME=?\r"
expect -re {OK\+TIME=[0-9]}
# set time and verify
send_string "AT+TIME=1673395800\r"
expect -re {OK\+TIME=167339580[0-1]}
set timeout 20
send_string "AT+TIME=?\r"
expect -re {OK\+TIME=167339[1-9][0-9][0-9][0-9]}
# set time parameter too long
send_string "AT+TIME=12345678901\r"
expect "FAIL+TIME=12345678901"
# set time parameter with unwanted characters
send_string "AT+TIME=1234567890a\r"
expect "FAIL+TIME=1234567890a"
# set location and verify
send_string "AT+LOCATION=-349205499,1386086737\r"
expect "OK+LOCATION=-349205499,1386086737"
send_string "AT+LOCATION=?\r"
expect "OK+LOCATION=-349205499,1386086737"
# set location to 0 and verify
send_string "AT+LOCATION=0,0\r"
expect "OK+LOCATION=0,0"
send_string "AT+LOCATION=?\r"
expect "OK+LOCATION=0,0"
set timeout 6
# set location with unwanted characters
send_string "AT+LOCATION=a,b\r"
expect "FAIL+LOCATION=a,b"
# set location with no ',' separater
send_string "AT+LOCATION=-349205499.1386086737\r"
expect "FAIL+LOCATION=-349205499.1386086737"
# set location with lat out of range
send_string "AT+LOCATION=-900000001,1386086737\r"
expect "FAIL+LOCATION=-900000001,1386086737"
# set location with lon out of range
send_string "AT+LOCATION=-349205499,1800000001\r"
expect "FAIL+LOCATION=-349205499,1800000001"
set timeout 20
# delete message from queue, no input, fail
send_string "AT+MSGQD\r"
expect "FAIL+MSGQD"
# delete message from queue, invalid input, fail
send_string "AT+MSGQD=-1\r"
expect "FAIL+MSGQD"
# delete message from queue, valid input, empty queue, fail
send_string "AT+MSGQD=0\r"
expect "FAIL+MSGQD"

# schedule message, 40 hex characters
send_string "AT+SMSG=0102030405060708091011121314151617181920\r"
expect "OK+SMSG=0102030405060708091011121314151617181920"
sleep 2
send_string "AT\r"
expect "OK"
# message queue status
send_string "AT+MSGQS=?\r"
expect -re {OK\+MSGQS=[0-9]+,[0-3]\s+}

# schedule message, 42 hex characters
send_user "user message 42 hex\r\n"
send_string "AT+SMSG=010203040506070809101112131415161718192021\r"
expect "OK+SMSG=010203040506070809101112131415161718192021"
sleep 2
send_string "AT\r"
expect "OK"
# message queue status, 2 messages status
send_string "AT+MSGQS=?\r"
expect -re {OK\+MSGQS=[0-9]+,[0-3],[0-9]+,[0-3]\s+}
# delete message from queue, valid input, success
send_string "AT+MSGQD=0\r"
expect "OK+MSGQD"
# message queue status, 1 message status
send_string "AT+MSGQS=?\r"
expect -re {OK\+MSGQS=[0-9]+,[0-3]\s+}

# schedule message, 46 hex characters
send_user "user message 46 hex\r\n"
send_string "AT+SMSG=0102030405060708091011121314151617181920212223\r"
expect "OK+SMSG=0102030405060708091011121314151617181920212223"
sleep 2
send_string "AT\r"
expect "OK"

# schedule message, 496 hex characters
send_user "user message 496 hex\r\n"
send_string "AT+SMSG=5601A4B74A9022F24D429E010451DCCFF2D3D528FEA59375A19A5581340AF38A0C97415627634974A6E776AA3952792B254F5323F4E7989581EE17B5F80A3F04A2805BC9E3A43E898BB433C406ADF02BFC434EF02AE786ABD59D60CDA79FD2491F2D1303D1518C5C05C0210B6D1136695484597F6BDF2A407C8B0E242AE06D4A0D804DDED1D93AD6995BE1066C176FC19CC94007A86A4825F556492036B66A4337B72108905BDF2AB7C03023D8A0E47469247B118FC33684197FA44F360E926DC5B375560F5480C615B0E9ED50CE61B9F2DCCB81A00106B981AA09B7B99B247E4F99D45EEE542403050DF055DB510FCE2DDA4FCDDB55875C\r"
expect "OK+SMSG=5601A4B74A9022F24D429E010451DCCFF2D3D528FEA59375A19A5581340AF38A0C97415627634974A6E776AA3952792B254F5323F4E7989581EE17B5F80A3F04A2805BC9E3A43E898BB433C406ADF02BFC434EF02AE786ABD59D60CDA79FD2491F2D1303D1518C5C05C0210B6D1136695484597F6BDF2A407C8B0E242AE06D4A0D804DDED1D93AD6995BE1066C176FC19CC94007A86A4825F556492036B66A4337B72108905BDF2AB7C03023D8A0E47469247B118FC33684197FA44F360E926DC5B375560F5480C615B0E9ED50CE61B9F2DCCB81A00106B981AA09B7B99B247E4F99D45EEE542403050DF055DB510FCE2DDA4FCDDB55875C"
sleep 2
send_string "AT\r"
expect "OK"

# schedule message, 1600 hex characters
send_user "user message 1600 hex\r\n"
send_string "AT+SMSG=FCEFB2F725AE1A889EA204317BC643F066DEBCFBB96EDAB649C4FA14AB2833A817E69F3D94B9C5325BC963D78FA6C7F68483F13EF1CBF43B8FEE4F3B1683E32E69826BFD3B302F96F9926D8939347FBDB770FBA93BF0E4CADE3305F5B6E8231F6A8E1CA5BE4B3CB7DEA94017DEBFD4952FD03E6AC022359E563A930C23B62C8D44483302946FBA7218FA89F6BA5D8CE92DCA54EDED898C43C31F4FE6D67B741AC4A71D5816D7CA2ED153258BB0B175DE7BC9CB685257AB1577FBFC4D7670673A1784922D5B5C5B2DAF80B860312D3EADF609154861C15ED8BC5A2532CA8C6DE111FF0E6C5C69990BEA526B1B7FA9C876B3DEBE149F1CEC5B76118D409DFA21AEFA2F1B5699B4618306CD9E867667FC2945BA3DE4D7293F4D3ACC8ED8C7AF86C1DFA117785678FB5C4599E2BC00DEE545992329704C68BD87354B5FFCFBE5BDDA87D452DD4C4D3992E61C4EE7FA332C93565603A3BEC12AF30C89EF076EACE1F58033D2CD800C5F6728AD4E22E07AB637D0B9DA8F7A0482878D728EFB1E70F19FA3C36C24CFCB8BF778D91A5853D08F248969B3046D358BFAA719F6C689E7652DAAD1517A9CDC7114B58B6C085BFC2CE565DFE9D31574CDBC8DC38217AAE74455B895CF5471406826CCD52E27D15B0C363AF5094F69D70CF79A8E0E4576529A2EE7698358A9EB7E75C0AC9D9107A9C8429FD19108A89DFF432C0D88A25F22D0468B539E343F1CAAFFC94791D0F059128F2AA498D34197166DA59E0F04C0E04B4B33E97F72062972CF70039F615CB2F08656885997206F05C50D14C9CDF4141828FE989A04C10CD3320F72936B2483F27A0C4B122CBB17F1C82BBA9620CFAE48CD46E2D108EFA43AFE16CD6A3B505CB55CA7C78862DE792B0A34C12A036F72D0B654A1BE4345F8425BC5AC9615084C72AF13FA12F2743DFCA8FE26AB6D987B23EC1CE13061D972BC9E1E53B4269F26D5B220E7A49424A03C22C6E7905E62B34B7E957BDF6EED9C0D0BEFC1318EE7064007EEE59C1285D8354CC0C5AA2278F5A10D70807C5D1C89680B4A999931A0DA388EBFD4A044ADD5906D9A3B8F13303020A1B19CFECD2567D96F0072A0A04CD92E0BADCF505AA4E0C73F1B57524C8772ED38\r"
expect "OK+SMSG=FCEFB2F725AE1A889EA204317BC643F066DEBCFBB96EDAB649C4FA14AB2833A817E69F3D94B9C5325BC963D78FA6C7F68483F13EF1CBF43B8FEE4F3B1683E32E69826BFD3B302F96F9926D8939347FBDB770FBA93BF0E4CADE3305F5B6E8231F6A8E1CA5BE4B3CB7DEA94017DEBFD4952FD03E6AC022359E563A930C23B62C8D44483302946FBA7218FA89F6BA5D8CE92DCA54EDED898C43C31F4FE6D67B741AC4A71D5816D7CA2ED153258BB0B175DE7BC9CB685257AB1577FBFC4D7670673A1784922D5B5C5B2DAF80B860312D3EADF609154861C15ED8BC5A2532CA8C6DE111FF0E6C5C69990BEA526B1B7FA9C876B3DEBE149F1CEC5B76118D409DFA21AEFA2F1B5699B4618306CD9E867667FC2945BA3DE4D7293F4D3ACC8ED8C7AF86C1DFA117785678FB5C4599E2BC00DEE545992329704C68BD87354B5FFCFBE5BDDA87D452DD4C4D3992E61C4EE7FA332C93565603A3BEC12AF30C89EF076EACE1F58033D2CD800C5F6728AD4E22E07AB637D0B9DA8F7A0482878D728EFB1E70F19FA3C36C24CFCB8BF778D91A5853D08F248969B3046D358BFAA719F6C689E7652DAAD1517A9CDC7114B58B6C085BFC2CE565DFE9D31574CDBC8DC38217AAE74455B895CF5471406826CCD52E27D15B0C363AF5094F69D70CF79A8E0E4576529A2EE7698358A9EB7E75C0AC9D9107A9C8429FD19108A89DFF432C0D88A25F22D0468B539E343F1CAAFFC94791D0F059128F2AA498D34197166DA59E0F04C0E04B4B33E97F72062972CF70039F615CB2F08656885997206F05C50D14C9CDF4141828FE989A04C10CD3320F72936B2483F27A0C4B122CBB17F1C82BBA9620CFAE48CD46E2D108EFA43AFE16CD6A3B505CB55CA7C78862DE792B0A34C12A036F72D0B654A1BE4345F8425BC5AC9615084C72AF13FA12F2743DFCA8FE26AB6D987B23EC1CE13061D972BC9E1E53B4269F26D5B220E7A49424A03C22C6E7905E62B34B7E957BDF6EED9C0D0BEFC1318EE7064007EEE59C1285D8354CC0C5AA2278F5A10D70807C5D1C89680B4A999931A0DA388EBFD4A044ADD5906D9A3B8F13303020A1B19CFECD2567D96F0072A0A04CD92E0BADCF505AA4E0C73F1B57524C8772ED38"
sleep 2
send_string "AT\r"
expect "OK"

# schedule message, 3000 hex characters
send_user "user message 3000 hex\r\n"
send_string "AT+SMSG=C3A93A906F122186271C949124E89A155066C079080E910362B1504029955BEC3F967CAEA89E34CFBAC961DEB1FBF30161B37A69C20B6D24BDBD64E653C0D392564F40FEED74CDA73D2E85EE2979EF8B2C69F4EE756113321F77187237EB048D3B448B28B859D0F68755E4B1CED43CFB3D30E9B292FCE4B174FD23ABE82739236BC44C231D1C19A571FE5640D2923B0FC224C25421A60595A328408C4F79AFBA3EFBDE5B17F70089F556C9C7E804D7AB2899FF493F05DEE32D1F6F7D981E37D61A1532310D32BA028983CA7187A11CB03A1CF97921D85C4EF7CBCB8FEA03660418983525CAF0285373F2C5FB93E1ABCDFDA4461E7CA36D736E3803583B695C54019279CB82A11FF593E4F026C59BF3C3403AE1BCDD4E304B8733A4C29C00169D9290681431870AC56BFAEB3196DFF4D619D592F624C241ABF5E56D91E6842E7814978D451E970A8A91F6BB27D5AFFDEE8490E4A8522553480BC1D9F1450869599FF69EBD8DA9471F9F024674B1446236D446DE266B326E76F348673850D191EFC72FAC55D8F47477F6BAEBA8FE4DDED293BCF9FFEE6775E1AFDD19FFAEAAEE75DA9BCAB28F3E2A85F9152DF7630BCAF6C8C3F5B62A6B98DA48B1D9F65CC86B366336E8F27412776D28A5658BB02F8178F2772F1CE2C7F62A78D020D4988B0AFBC1F3ED360564A32D0908B8BA373A3229B1614693283CBDA10CDD75A468809F2A738C6078F103A6FA0C5EB44398E76D4948B3DC71EF9912FC7687A0DF0740097ACC69F3BD6C99B878F76CBC905329D99CDCB60DCB4F1FC7C6A668A5AEA8AE2874171B3283B4EAFCAC56B83CAAE11546BDCB53881B7250E118B886C66034EFD44B0A06CEBFF0CA6B4782A7F163BC3720888AA9A3FCF98414B10ADB113ECAE589D4EC5793DC22FE23A4A51408624B28EAD5D18DD1CA11E67B1BC18C598B72E25F5E39F33A5BF15E00977208F9BE30E393027065CC814B489C0CD4F59746D7F6A410E9DF6CDB3D6C72AF746B6DA44E01A6BE66733FB1BBDBBD8FD054D6A74A7AB73459230F968F814603ECB3A83AB44EF81AC137CB7C12880CE2DCE289275C405BB6646A4CF3EB92F7D7469F11FAED0915AF40E02B526937344519BD6C76FDC72C613178551C0B4CF351EB044BD80D60874D41B39FAAEAD3EF04905C7A8E23A6EF551E44712990657A7B69C6547726DBC4678E64117937017DC85DF756809D45D5BB8A47E51AAC5F961525EA8C4CC551B354B5C5CDECC64AB423410AA3DE507999DAC07EF46CDE8A8103740E4F3A5F038E14C85B008EA5B5B1E6BF54C40FCD5DE98DDCDEF9BA687BBDDD890D17E810A5FCD800FC66A5B1178B716B4F8039AC6AC68848C042B03B008DC40DA4AC1D49A8F549A45BEE567279C7DDC8471675B1DDFDF99D40AAD840379C4DDC486A25F05F6F94BA5DEA2CD7B1099FF92014AAFD12A49A524E7292850EDF6156498746A8F6DA6253C58E2A7697CA6FB7DE1AB4F0BE4E420CC0D491CEB3F324FC7A6AA4704506C30A94EE802CB8F0E3960A9887C8E6C9D4A79E657551589A4ED204F24249F906538DF4D4B9ACC49D42CE35C9961B936AC231CF388228D2D0FAD6C33D20BC437349374703E30BA025D9D5EF6FF082D9B3B3A9EB35D1BD06CB93C908B3854B27CE826ED1657A718B53467AC337FC9CEAAF45D5E41692EAE225B3EAD938360007B86ED81EE84AA93C9023FFC71F9BB1CEE186B2F7189DD93E50C41789FA1790B28568D06EB279AA439CA90ABB44BC8925423C1D5BD9F69929BAB0B2B4C742674CAB37BA5DB164A04D0DAB0952679277A9CE9404A78B9DD1454D83FA14C6616171981BCE49806F978D1AA0DF8132572A01EB2FA876CC79BC1AFDB62EC3178F34AFAB02F92B7190B88B30980C62EF3763DA660C5132850D4C82C37B45DA0A7989B57C82E0ED129979423185A520BC08FA22144B559A58A11C1B1C62F527DB7FDC5701BD451456BE568743FBA70004A12218ED77B24519CF613531565C0CD53964D7F6A9EB4C6741D3AA3D7AAA411BCD5908440C4E5DDBAF930C05EF18DB287CB21E259D6A8CDE3D371BB7E15CD3AEB6DBF3C229509DD8E3A9DED3C1B9FB3E6B1A630884F0E6C2270279085E4CB71428\r"
expect "OK+SMSG=C3A93A906F122186271C949124E89A155066C079080E910362B1504029955BEC3F967CAEA89E34CFBAC961DEB1FBF30161B37A69C20B6D24BDBD64E653C0D392564F40FEED74CDA73D2E85EE2979EF8B2C69F4EE756113321F77187237EB048D3B448B28B859D0F68755E4B1CED43CFB3D30E9B292FCE4B174FD23ABE82739236BC44C231D1C19A571FE5640D2923B0FC224C25421A60595A328408C4F79AFBA3EFBDE5B17F70089F556C9C7E804D7AB2899FF493F05DEE32D1F6F7D981E37D61A1532310D32BA028983CA7187A11CB03A1CF97921D85C4EF7CBCB8FEA03660418983525CAF0285373F2C5FB93E1ABCDFDA4461E7CA36D736E3803583B695C54019279CB82A11FF593E4F026C59BF3C3403AE1BCDD4E304B8733A4C29C00169D9290681431870AC56BFAEB3196DFF4D619D592F624C241ABF5E56D91E6842E7814978D451E970A8A91F6BB27D5AFFDEE8490E4A8522553480BC1D9F1450869599FF69EBD8DA9471F9F024674B1446236D446DE266B326E76F348673850D191EFC72FAC55D8F47477F6BAEBA8FE4DDED293BCF9FFEE6775E1AFDD19FFAEAAEE75DA9BCAB28F3E2A85F9152DF7630BCAF6C8C3F5B62A6B98DA48B1D9F65CC86B366336E8F27412776D28A5658BB02F8178F2772F1CE2C7F62A78D020D4988B0AFBC1F3ED360564A32D0908B8BA373A3229B1614693283CBDA10CDD75A468809F2A738C6078F103A6FA0C5EB44398E76D4948B3DC71EF9912FC7687A0DF0740097ACC69F3BD6C99B878F76CBC905329D99CDCB60DCB4F1FC7C6A668A5AEA8AE2874171B3283B4EAFCAC56B83CAAE11546BDCB53881B7250E118B886C66034EFD44B0A06CEBFF0CA6B4782A7F163BC3720888AA9A3FCF98414B10ADB113ECAE589D4EC5793DC22FE23A4A51408624B28EAD5D18DD1CA11E67B1BC18C598B72E25F5E39F33A5BF15E00977208F9BE30E393027065CC814B489C0CD4F59746D7F6A410E9DF6CDB3D6C72AF746B6DA44E01A6BE66733FB1BBDBBD8FD054D6A74A7AB73459230F968F814603ECB3A83AB44EF81AC137CB7C12880CE2DCE289275C405BB6646A4CF3EB92F7D7469F11FAED0915AF40E02B526937344519BD6C76FDC72C613178551C0B4CF351EB044BD80D60874D41B39FAAEAD3EF04905C7A8E23A6EF551E44712990657A7B69C6547726DBC4678E64117937017DC85DF756809D45D5BB8A47E51AAC5F961525EA8C4CC551B354B5C5CDECC64AB423410AA3DE507999DAC07EF46CDE8A8103740E4F3A5F038E14C85B008EA5B5B1E6BF54C40FCD5DE98DDCDEF9BA687BBDDD890D17E810A5FCD800FC66A5B1178B716B4F8039AC6AC68848C042B03B008DC40DA4AC1D49A8F549A45BEE567279C7DDC8471675B1DDFDF99D40AAD840379C4DDC486A25F05F6F94BA5DEA2CD7B1099FF92014AAFD12A49A524E7292850EDF6156498746A8F6DA6253C58E2A7697CA6FB7DE1AB4F0BE4E420CC0D491CEB3F324FC7A6AA4704506C30A94EE802CB8F0E3960A9887C8E6C9D4A79E657551589A4ED204F24249F906538DF4D4B9ACC49D42CE35C9961B936AC231CF388228D2D0FAD6C33D20BC437349374703E30BA025D9D5EF6FF082D9B3B3A9EB35D1BD06CB93C908B3854B27CE826ED1657A718B53467AC337FC9CEAAF45D5E41692EAE225B3EAD938360007B86ED81EE84AA93C9023FFC71F9BB1CEE186B2F7189DD93E50C41789FA1790B28568D06EB279AA439CA90ABB44BC8925423C1D5BD9F69929BAB0B2B4C742674CAB37BA5DB164A04D0DAB0952679277A9CE9404A78B9DD1454D83FA14C6616171981BCE49806F978D1AA0DF8132572A01EB2FA876CC79BC1AFDB62EC3178F34AFAB02F92B7190B88B30980C62EF3763DA660C5132850D4C82C37B45DA0A7989B57C82E0ED129979423185A520BC08FA22144B559A58A11C1B1C62F527DB7FDC5701BD451456BE568743FBA70004A12218ED77B24519CF613531565C0CD53964D7F6A9EB4C6741D3AA3D7AAA411BCD5908440C4E5DDBAF930C05EF18DB287CB21E259D6A8CDE3D371BB7E15CD3AEB6DBF3C229509DD8E3A9DED3C1B9FB3E6B1A630884F0E6C2270279085E4CB71428"
sleep 2
send_string "AT\r"
expect "OK"

# schedule message invalid characters
send_string "AT+SMSG=in02030405060708091011121314151617181920\r"
expect "ERROR=INVALID_PARAMETER"
# schedule message character number is odd
send_string "AT+SMSG=010203040506070809101112131415161718192\r"
expect "ERROR=INVALID_PARAMETER"
# no control command match - 1
send_string "AT+MID\r"
expect "ERROR=UNKNOWN_CONTROL_CMD"
# no control command match - 2
send_string "AT+MID=1\r"
expect "ERROR=UNKNOWN_CONTROL_CMD"

## ERRORS
# case sensitivity - prefix
send_string "At+RSSI\r"
expect "ERROR=INVALID_COMMAND"
# case sensitivity - command
send_string "AT+rssi\r"
expect "ERROR=UNKNOWN_CONTROL_CMD"
# command too long
send_string "12345678901234567890123456789012345678901234567890123456789012345678901234567890\r"
expect "ERROR=INVALID_COMMAND"
# make sure valid commands can still be processed
send_string "AT\r"
expect "OK"
# command too short
send_string "A\r"
expect "ERROR=INVALID_COMMAND"
# no prefix found - 1
send_string "A+REGCODE=?\r"
expect "ERROR=INVALID_COMMAND"
# no prefix found - 2
send_string "T+REGCODE=?\r"
expect "ERROR=INVALID_COMMAND"
# no prefix found - 3
send_string "+REGCODE=?\r"
expect "ERROR=INVALID_COMMAND"
# command too long
send_string "AT+REGCODEREGC=?\r"
expect "ERROR=INVALID_COMMAND"

send_user "Done\r\n"
close
